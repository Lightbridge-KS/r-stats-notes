{
  "hash": "bcdd42d60b1905db99985ccc1d1cc60a",
  "result": {
    "markdown": "---\ntitle: \"Wilcoxon Test\"\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(rstatix)\nlibrary(ggpubr)\n```\n:::\n\n\n**References:**\n\n-   [Wilcoxon test in R](https://www.datanovia.com/en/lessons/wilcoxon-test-in-r/): data novia\n\n-   [Wilcoxon test](https://statsandr.com/blog/wilcoxon-test-in-r-how-to-compare-2-groups-under-the-non-normality-assumption/): stats and R\n\n## Introduction\n\n-   The Wilcoxon test is a non-parametric test for comparing 2 groups\n\n-   Less powerful than t-test, i.e., more likely to fail to reject the $H_0$ that there is no difference.\n\n::: callout-tips\n#### When to use\n\nData is not normally distributed *and* the sample size is small (n < 30) (so that central limit theorem not applied)\n:::\n\n## Wilcoxon signed rank test on paired samples\n\n### Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Wide format\ndata(\"mice2\", package = \"datarium\")\nhead(mice2, 3)\n#>   id before after\n#> 1  1  187.2 429.5\n#> 2  2  194.2 404.4\n#> 3  3  231.7 405.6\n```\n:::\n\n\nTransform to long\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmice2.long <- mice2 %>%\n  gather(key = \"group\", value = \"weight\", before, after)\n\nhead(mice2.long, 3)\n#>   id  group weight\n#> 1  1 before  187.2\n#> 2  2 before  194.2\n#> 3  3 before  231.7\n```\n:::\n\n\n### Summary Stats\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmice2.long %>%\n  group_by(group) %>%\n  get_summary_stats(weight, type = \"median_iqr\")\n#> # A tibble: 2 × 5\n#>   group  variable     n median   iqr\n#>   <chr>  <chr>    <dbl>  <dbl> <dbl>\n#> 1 after  weight      10   405   28.3\n#> 2 before weight      10   197.  19.2\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggpaired(mice2.long, x = \"group\", y = \"weight\", \n         order = c(\"before\", \"after\"),\n         ylab = \"Weight\", xlab = \"Groups\")\n```\n\n::: {.cell-output-display}\n![](wilcoxon_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nThe test assumes that differences between paired samples should be distributed symmetrically around the median.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmice2d <- mice2 %>% \n  mutate(differences = after - before)\n\ngghistogram(mice2d, x = \"differences\", y = \"..density..\", \n            fill = \"steelblue\",bins = 5, add_density = TRUE)\n```\n\n::: {.cell-output-display}\n![](wilcoxon_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n### Computation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwilcox.test(weight ~ group, data = mice2.long, paired = TRUE)\n#> \n#> \tWilcoxon signed rank exact test\n#> \n#> data:  weight by group\n#> V = 55, p-value = 0.001953\n#> alternative hypothesis: true location shift is not equal to 0\n```\n:::\n\n\nOr\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstat.test <- mice2.long  %>%\n  wilcox_test(weight ~ group, paired = TRUE) %>%\n  add_significance()\n\nstat.test\n#> # A tibble: 1 × 8\n#>   .y.    group1 group2    n1    n2 statistic       p p.signif\n#> * <chr>  <chr>  <chr>  <int> <int>     <dbl>   <dbl> <chr>   \n#> 1 weight after  before    10    10        55 0.00195 **\n```\n:::\n\n\n### Effect size\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmice2.long  %>%\n  wilcox_effsize(weight ~ group, paired = TRUE)\n#> # A tibble: 1 × 7\n#>   .y.    group1 group2 effsize    n1    n2 magnitude\n#> * <chr>  <chr>  <chr>    <dbl> <int> <int> <ord>    \n#> 1 weight after  before   0.886    10    10 large\n```\n:::\n\n\n### Viz `ggplot2`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmice2.long %>% \n  ggplot(aes(group, weight, color = group, fill = group)) +\n  geom_boxplot(alpha = 0.4) +\n  geom_jitter() +\n  ggpubr::stat_compare_means(method = \"wilcox.test\",\n                             paired = TRUE, \n                             label.x = 1.5, \n                             label.y = 450, \n                             show.legend = F)\n```\n\n::: {.cell-output-display}\n![](wilcoxon_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n### Viz: `{ggstatsplot}`\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggstatsplot)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123) # Seed for bootstraped CI\n\nggwithinstats( # paired samples\n  data = mice2.long,\n  x = group,\n  y = weight,\n  type = \"nonparametric\", # for wilcoxon\n  centrality.plotting = FALSE # remove median\n)\n```\n\n::: {.cell-output-display}\n![](wilcoxon_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "wilcoxon_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}