{
  "hash": "aaeed5b455b8e8dbf888421769ccb752",
  "result": {
    "markdown": "---\ntitle: \"Diagnosis Accuracy\"\n---\n\n\n\n\n\nAdaped from: [Link](https://rowannicholls.github.io/R/statistics/tutorial.html#data-manipulation)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(titanic_train)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"PassengerId\" \"Survived\"    \"Pclass\"      \"Name\"        \"Sex\"        \n [6] \"Age\"         \"SibSp\"       \"Parch\"       \"Ticket\"      \"Fare\"       \n[11] \"Cabin\"       \"Embarked\"   \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nskimr::skim(titanic_train)\n```\n\n::: {.cell-output-display}\nTable: Data summary\n\n|                         |              |\n|:------------------------|:-------------|\n|Name                     |titanic_train |\n|Number of rows           |891           |\n|Number of columns        |12            |\n|_______________________  |              |\n|Column type frequency:   |              |\n|character                |5             |\n|numeric                  |7             |\n|________________________ |              |\n|Group variables          |None          |\n\n\n**Variable type: character**\n\n|skim_variable | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:-------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|Name          |         0|             1|  12|  82|     0|      891|          0|\n|Sex           |         0|             1|   4|   6|     0|        2|          0|\n|Ticket        |         0|             1|   3|  18|     0|      681|          0|\n|Cabin         |         0|             1|   0|  15|   687|      148|          0|\n|Embarked      |         0|             1|   0|   1|     2|        4|          0|\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|   mean|     sd|   p0|    p25|    p50|   p75|   p100|hist  |\n|:-------------|---------:|-------------:|------:|------:|----:|------:|------:|-----:|------:|:-----|\n|PassengerId   |         0|           1.0| 446.00| 257.35| 1.00| 223.50| 446.00| 668.5| 891.00|▇▇▇▇▇ |\n|Survived      |         0|           1.0|   0.38|   0.49| 0.00|   0.00|   0.00|   1.0|   1.00|▇▁▁▁▅ |\n|Pclass        |         0|           1.0|   2.31|   0.84| 1.00|   2.00|   3.00|   3.0|   3.00|▃▁▃▁▇ |\n|Age           |       177|           0.8|  29.70|  14.53| 0.42|  20.12|  28.00|  38.0|  80.00|▂▇▅▂▁ |\n|SibSp         |         0|           1.0|   0.52|   1.10| 0.00|   0.00|   0.00|   1.0|   8.00|▇▁▁▁▁ |\n|Parch         |         0|           1.0|   0.38|   0.81| 0.00|   0.00|   0.00|   0.0|   6.00|▇▁▁▁▁ |\n|Fare          |         0|           1.0|  32.20|  49.69| 0.00|   7.91|  14.45|  31.0| 512.33|▇▁▁▁▁ |\n:::\n:::\n\n\n\n## Survived vs Fare: Any difference ?\n\nLet’s ask the following question: were those people who paid more for their ticket more likely to survive? \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggstatsplot::ggbetweenstats(\n  titanic_train,\n  x = Survived,\n  y = Fare\n)\n```\n\n::: {.cell-output-display}\n![](dta_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\nConfirm the difference in `Fare` between 2 groups.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwilcox.test(titanic_train$Fare ~ titanic_train$Survived)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tWilcoxon rank sum test with continuity correction\n\ndata:  titanic_train$Fare by titanic_train$Survived\nW = 57806, p-value < 2.2e-16\nalternative hypothesis: true location shift is not equal to 0\n```\n:::\n:::\n\n\n## DTA (Manual Way)\n\nNow let’s ask a slightly different question: can a passenger’s fare price be used to predict where or not they survived?\n\n### Prep Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntitanic_sub <- titanic_train |> \n  select(Fare, Survived) |> \n  mutate(Survived_orig = ifelse(Survived == 1L, \"Lived\", \"Died\")) |> \n  mutate(Survived_pred = ifelse(Fare > 14.45, \"Lived\", \"Died\")) |> \n  mutate(across(starts_with(\"Survived_\"), \n                ~factor(.x, levels = c(\"Lived\", \"Died\"))))\n\nhead(titanic_sub)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     Fare Survived Survived_orig Survived_pred\n1  7.2500        0          Died          Died\n2 71.2833        1         Lived         Lived\n3  7.9250        1         Lived          Died\n4 53.1000        1         Lived         Lived\n5  8.0500        0          Died          Died\n6  8.4583        0          Died          Died\n```\n:::\n:::\n\n\n### Confusion Matrix\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncm <- table(pred = titanic_sub$Survived_pred, \n      orig = titanic_sub$Survived_orig)\n\ncm\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       orig\npred    Lived Died\n  Lived   231  220\n  Died    111  329\n```\n:::\n:::\n\n\n### Diagnostic Accuracy\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# True Positive\n(tp <- cm[1, 1])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 231\n```\n:::\n\n```{.r .cell-code}\n# False Positive\n(fp <- cm[1, 2])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 220\n```\n:::\n\n```{.r .cell-code}\n# False Negative\n(fn <- cm[2, 1])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 111\n```\n:::\n\n```{.r .cell-code}\n# True Negative\n(tn <- cm[2, 2])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 329\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Sense\ntp / (tp + fn)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.6754386\n```\n:::\n\n```{.r .cell-code}\n# Spec\ntn / (tn + fp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.5992714\n```\n:::\n\n```{.r .cell-code}\n# PPV\ntp / (tp + fp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.5121951\n```\n:::\n\n```{.r .cell-code}\n# NPV\ntn / (tn + fn)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.7477273\n```\n:::\n:::\n\n\n## ROC Curve\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nr1 <- roc(Survived_orig ~ Fare, data = titanic_sub)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nSetting levels: control = Lived, case = Died\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nSetting direction: controls > cases\n```\n:::\n\n```{.r .cell-code}\nr1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nroc.formula(formula = Survived_orig ~ Fare, data = titanic_sub)\n\nData: Fare in 342 controls (Survived_orig Lived) > 549 cases (Survived_orig Died).\nArea under the curve: 0.6921\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# AUC\n(auc <- auc(r1))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nArea under the curve: 0.6921\n```\n:::\n\n```{.r .cell-code}\n# Confidence Interval\n(ci <- ci.auc(r1))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n95% CI: 0.6567-0.7276 (DeLong)\n```\n:::\n\n```{.r .cell-code}\nci_l <- round(ci[1], 2) # Lower\nci_u <- round(ci[3], 2) # Upper\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(r1$thresholds)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1]      Inf 387.6646 262.6875 254.9479 237.5229 224.6521\n```\n:::\n:::\n\n\n### Plot (Base R)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(r1, type = \"S\")\n```\n\n::: {.cell-output-display}\n![](dta_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n### Plot (ggplot2)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlegend_text <- paste0(\n    \"AUC = \", round(auc, 2), \" (95% CI = \", ci_l, \" - \", ci_u, \")\"\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggroc(r1)+ \n  ggtitle(\"Receiver Operating Characteristic Curve\") +\n  geom_segment(\n    aes(x = 1, xend = 0, y = 0, yend = 1), color = \"grey\", \n    linetype = \"dashed\" ) +\n  scale_y_continuous(expand = c(0, 0)) + \n  scale_x_reverse(expand = c(0, 0)) + \n  annotate(\"text\", x = 0.3, y = 0.05, label = legend_text)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nScale for x is already present.\nAdding another scale for x, which will replace the existing scale.\n```\n:::\n\n::: {.cell-output-display}\n![](dta_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "dta_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}